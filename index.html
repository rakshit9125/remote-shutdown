<!doctype html>
<html>
  <head>
    <title>Computer List</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f8f9fa;
        padding: 20px;
      }
      h1 {
        text-align: center;
      }
      .pc {
        background: white;
        padding: 15px;
        margin: 10px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      button {
        background: red;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
      }
      button:hover {
        background: darkred;
      }
    </style>
  </head>
  <body>
    <h1>Active Computers</h1>
    <div id="pc-list"></div>

    <script>
      async function fetchPCs() {
        try {
          const res = await fetch("/list");
          const data = await res.json();
          const container = document.getElementById("pc-list");
          container.innerHTML = "";

          for (const [pc, info] of Object.entries(data)) {
            const lastSeen = new Date(info.lastSeen).toLocaleTimeString();
            const div = document.createElement("div");
            div.className = "pc";
            div.innerHTML = `
              <span><b>${pc}</b> (Last seen: ${lastSeen})</span>
              <button onclick="shutdown('${pc}')">Shutdown</button>
            `;
            container.appendChild(div);
          }
        } catch (err) {
          console.error("Error fetching PCs:", err);
        }
      }

      async function shutdown(pc) {
        try {
          const res = await fetch(`/shutdown?pc=${encodeURIComponent(pc)}`, {
            method: "POST",
          });
          const text = await res.text();
          alert(text);
        } catch (err) {
          alert("Error sending shutdown command!");
          console.error(err);
        }
      }

      setInterval(fetchPCs, 3000);
      fetchPCs();
    </script>
  </body>
</html>
